{
	"info": {
		"_postman_id": "webhook-instance-collection",
		"name": "14 - Instance Webhooks",
		"description": "Coleção para gerenciar webhooks de instâncias - suporte a múltiplos webhooks por instância",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Listar Webhooks da Instância",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/instances/{{instance_id}}/webhooks",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances",
						"{{instance_id}}",
						"webhooks"
					]
				},
				"description": "Lista todos os webhooks configurados para uma instância específica"
			},
			"response": [
				{
					"name": "Sucesso - Lista de Webhooks",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/instances/1/webhooks",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"instances",
								"1",
								"webhooks"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": 1,\n      \"instance_id\": 1,\n      \"webhook_url\": \"https://webhook.site/11111111-1111-1111-1111-11111111\",\n      \"events\": [\"message\", \"message.ack\"],\n      \"is_active\": true,\n      \"retry_count\": 0,\n      \"last_retry_at\": null,\n      \"created_at\": \"2025-01-29T10:30:00Z\",\n      \"updated_at\": \"2025-01-29T10:30:00Z\"\n    },\n    {\n      \"id\": 2,\n      \"instance_id\": 1,\n      \"webhook_url\": \"https://webhook.cool/22222222-2222-2222-2222-22222222\",\n      \"events\": [\"session.status\", \"presence.update\"],\n      \"is_active\": true,\n      \"retry_count\": 0,\n      \"last_retry_at\": null,\n      \"created_at\": \"2025-01-29T10:30:00Z\",\n      \"updated_at\": \"2025-01-29T10:30:00Z\"\n    }\n  ],\n  \"total\": 2\n}"
				}
			]
		},
		{
			"name": "Criar Webhook para Instância",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"url\": \"https://webhook.site/33333333-3333-3333-3333-33333333\",\n  \"events\": [\"message\", \"message.ack\", \"presence.update\"],\n  \"is_active\": true\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/instances/{{instance_id}}/webhooks",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances",
						"{{instance_id}}",
						"webhooks"
					]
				},
				"description": "Cria um novo webhook para uma instância específica"
			},
			"response": [
				{
					"name": "Sucesso - Webhook Criado",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{company_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"url\": \"https://webhook.site/33333333-3333-3333-3333-33333333\",\n  \"events\": [\"message\", \"message.ack\", \"presence.update\"],\n  \"is_active\": true\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/instances/1/webhooks",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"instances",
								"1",
								"webhooks"
							]
						}
					},
					"status": "Created",
					"code": 201,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"message\": \"Webhook criado com sucesso\",\n  \"data\": {\n    \"id\": 3,\n    \"instance_id\": 1,\n    \"webhook_url\": \"https://webhook.site/33333333-3333-3333-3333-33333333\",\n    \"events\": [\"message\", \"message.ack\", \"presence.update\"],\n    \"is_active\": true,\n    \"retry_count\": 0,\n    \"last_retry_at\": null,\n    \"created_at\": \"2025-01-29T10:35:00Z\",\n    \"updated_at\": \"2025-01-29T10:35:00Z\"\n  }\n}"
				}
			]
		},
		{
			"name": "Atualizar Webhook - Eventos",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"events\": [\"message\", \"message.ack\", \"session.status\", \"presence.update\"]\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/instances/{{instance_id}}/webhooks/{{webhook_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances",
						"{{instance_id}}",
						"webhooks",
						"{{webhook_id}}"
					]
				},
				"description": "Atualiza apenas os eventos de um webhook existente"
			},
			"response": [
				{
					"name": "Sucesso - Webhook Atualizado",
					"originalRequest": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{company_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"events\": [\"message\", \"message.ack\", \"session.status\"],\n  \"is_active\": false\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/instances/1/webhooks/3",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"instances",
								"1",
								"webhooks",
								"3"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"message\": \"Webhook atualizado com sucesso\",\n  \"data\": {\n    \"id\": 3,\n    \"instance_id\": 1,\n    \"webhook_url\": \"https://webhook.site/33333333-3333-3333-3333-33333333\",\n    \"events\": [\"message\", \"message.ack\", \"session.status\"],\n    \"is_active\": false,\n    \"retry_count\": 0,\n    \"last_retry_at\": null,\n    \"created_at\": \"2025-01-29T10:35:00Z\",\n    \"updated_at\": \"2025-01-29T10:40:00Z\"\n  }\n}"
				}
			]
		},
		{
			"name": "Atualizar Webhook - Ativar/Desativar",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"is_active\": false\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/instances/{{instance_id}}/webhooks/{{webhook_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances",
						"{{instance_id}}",
						"webhooks",
						"{{webhook_id}}"
					]
				},
				"description": "Ativa ou desativa um webhook existente"
			},
			"response": [
				{
					"name": "Sucesso - Webhook Desativado",
					"originalRequest": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{company_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"is_active\": false\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/instances/1/webhooks/3",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"instances",
								"1",
								"webhooks",
								"3"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"message\": \"Webhook atualizado com sucesso\",\n  \"data\": {\n    \"id\": 3,\n    \"instance_id\": 1,\n    \"webhook_url\": \"https://webhook.site/33333333-3333-3333-3333-33333333\",\n    \"events\": [\"message\", \"message.ack\", \"presence.update\"],\n    \"is_active\": false,\n    \"retry_count\": 0,\n    \"last_retry_at\": null,\n    \"created_at\": \"2025-01-29T10:35:00Z\",\n    \"updated_at\": \"2025-01-29T10:50:00Z\"\n  }\n}"
				}
			]
		},
		{
			"name": "Atualizar Webhook - URL",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"url\": \"https://nova-url.com/webhook/atualizado\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/instances/{{instance_id}}/webhooks/{{webhook_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances",
						"{{instance_id}}",
						"webhooks",
						"{{webhook_id}}"
					]
				},
				"description": "Atualiza a URL de um webhook existente"
			},
			"response": [
				{
					"name": "Sucesso - URL Atualizada",
					"originalRequest": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{company_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"url\": \"https://nova-url.com/webhook/atualizado\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/instances/1/webhooks/3",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"instances",
								"1",
								"webhooks",
								"3"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"message\": \"Webhook atualizado com sucesso\",\n  \"data\": {\n    \"id\": 3,\n    \"instance_id\": 1,\n    \"webhook_url\": \"https://nova-url.com/webhook/atualizado\",\n    \"events\": [\"message\", \"message.ack\", \"presence.update\"],\n    \"is_active\": true,\n    \"retry_count\": 0,\n    \"last_retry_at\": null,\n    \"created_at\": \"2025-01-29T10:35:00Z\",\n    \"updated_at\": \"2025-01-29T10:55:00Z\"\n  }\n}"
				}
			]
		},
		{
			"name": "Atualizar Webhook - Completo",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"url\": \"https://webhook-final.com/endpoint\",\n  \"events\": [\"message\", \"message.ack\", \"session.status\", \"presence.update\", \"group.v2.join\"],\n  \"is_active\": true\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/instances/{{instance_id}}/webhooks/{{webhook_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances",
						"{{instance_id}}",
						"webhooks",
						"{{webhook_id}}"
					]
				},
				"description": "Atualiza todos os campos de um webhook (URL, eventos e status)"
			},
			"response": [
				{
					"name": "Sucesso - Webhook Completamente Atualizado",
					"originalRequest": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{company_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"url\": \"https://webhook-final.com/endpoint\",\n  \"events\": [\"message\", \"message.ack\", \"session.status\", \"presence.update\", \"group.v2.join\"],\n  \"is_active\": true\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/instances/1/webhooks/3",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"instances",
								"1",
								"webhooks",
								"3"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"message\": \"Webhook atualizado com sucesso\",\n  \"data\": {\n    \"id\": 3,\n    \"instance_id\": 1,\n    \"webhook_url\": \"https://webhook-final.com/endpoint\",\n    \"events\": [\"message\", \"message.ack\", \"session.status\", \"presence.update\", \"group.v2.join\"],\n    \"is_active\": true,\n    \"retry_count\": 0,\n    \"last_retry_at\": null,\n    \"created_at\": \"2025-01-29T10:35:00Z\",\n    \"updated_at\": \"2025-01-29T11:00:00Z\"\n  }\n}"
				}
			]
		},
		{
			"name": "Deletar Webhook",
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{base_url}}/api/instances/{{instance_id}}/webhooks/{{webhook_id}}",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances",
						"{{instance_id}}",
						"webhooks",
						"{{webhook_id}}"
					]
				},
				"description": "Remove um webhook de uma instância"
			},
			"response": [
				{
					"name": "Sucesso - Webhook Deletado",
					"originalRequest": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{company_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/instances/1/webhooks/3",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"instances",
								"1",
								"webhooks",
								"3"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"message\": \"Webhook removido com sucesso\"\n}"
				}
			]
		},
		{
			"name": "Criar Instância com Múltiplos Webhooks",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"instance_name\": \"instancia-com-webhooks\",\n  \"provider_id\": 1,\n  \"phone_number\": \"5511999999999\",\n  \"webhooks\": [\n    {\n      \"url\": \"https://webhook.site/11111111-1111-1111-1111-11111111\",\n      \"events\": [\"message\", \"message.ack\"],\n      \"is_active\": true\n    },\n    {\n      \"url\": \"https://webhook.cool/22222222-2222-2222-2222-22222222\",\n      \"events\": [\"session.status\", \"presence.update\"],\n      \"is_active\": true\n    },\n    {\n      \"url\": \"https://meu-servidor.com/webhook/analytics\",\n      \"events\": [\"message\", \"message.ack\", \"session.status\", \"presence.update\", \"group.v2.join\", \"group.v2.leave\"],\n      \"is_active\": true\n    }\n  ]\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/instances",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances"
					]
				},
				"description": "Cria uma nova instância com múltiplos webhooks configurados"
			},
			"response": [
				{
					"name": "Sucesso - Instância com Webhooks Criada",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{company_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"instance_name\": \"instancia-com-webhooks\",\n  \"provider_id\": 1,\n  \"phone_number\": \"5511999999999\",\n  \"webhooks\": [\n    {\n      \"url\": \"https://webhook.site/11111111-1111-1111-1111-11111111\",\n      \"events\": [\"message\", \"message.ack\"],\n      \"is_active\": true\n    },\n    {\n      \"url\": \"https://webhook.cool/22222222-2222-2222-2222-22222222\",\n      \"events\": [\"session.status\", \"presence.update\"],\n      \"is_active\": true\n    }\n  ]\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/instances",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"instances"
							]
						}
					},
					"status": "Created",
					"code": 201,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"message\": \"Instância criada com sucesso\",\n  \"data\": {\n    \"id\": 2,\n    \"company_id\": 1,\n    \"provider_id\": 1,\n    \"instance_name\": \"instancia-com-webhooks\",\n    \"phone_number\": \"5511999999999\",\n    \"status\": \"creating\",\n    \"webhook_url\": null,\n    \"external_instance_id\": null,\n    \"created_at\": \"2025-01-29T10:45:00Z\",\n    \"updated_at\": \"2025-01-29T10:45:00Z\"\n  }\n}"
				}
			]
		},
		{
			"name": "Exemplo - Webhook com Headers Customizados",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{company_token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"url\": \"https://api.meuservidor.com/webhook/seguro\",\n  \"events\": [\"message\", \"message.ack\"],\n  \"is_active\": true,\n  \"customHeaders\": {\n    \"X-API-Key\": \"minha-chave-secreta-123\",\n    \"X-Custom-Header\": \"valor-customizado\"\n  }\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{base_url}}/api/instances/{{instance_id}}/webhooks",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"instances",
						"{{instance_id}}",
						"webhooks"
					]
				},
				"description": "Exemplo de criação de webhook com headers customizados (para referência - não implementado ainda)"
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "company_token",
			"value": "seu-token-aqui",
			"type": "string"
		},
		{
			"key": "instance_id",
			"value": "1",
			"type": "string"
		},
		{
			"key": "webhook_id",
			"value": "1",
			"type": "string"
		}
	]
}
